<html>
	<head>
		<title>bike share graph test</title>
		<script src="http://mbostock.github.com/d3/d3.v2.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<style>
			/* tell the SVG path to be a thin blue line without any area fill */
			path {
				stroke: steelblue;
				stroke-width: 1;
				fill: none;
			}
			
			.axis {
			  shape-rendering: crispEdges;
			}
 
			.x.axis line {
			  stroke: lightgrey;
			}
 
			.x.axis .minor {
			  stroke-opacity: .5;
			}
 
			.x.axis path {
			  display: none;
			}
 
			.y.axis line, .y.axis path {
			  fill: none;
			  stroke: #000;
			}
		</style>
	</head>
	<body>
 
 
	<div id="graph" class="aGraph"></div>
 
 
	<script>
/* implementation heavily influenced by http://bl.ocks.org/1166403 */

// define dimensions of graph
var m = [80, 80, 80, 80]; // margins
var w = 800 - m[1] - m[3]; // width
var h = 400 - m[0] - m[2]; // height

// inputs: station id and variable to graph.
var stationid = '10';
var stationindex;
var data;


// Add an SVG element with the desired dimensions and margin.
var graph = d3.select("#graph").append("svg:svg")
      .attr("width", w + m[1] + m[3])
      .attr("height", h + m[0] + m[2])
    .append("svg:g")
      .attr("transform", "translate(" + m[3] + "," + m[0] + ")");

var stationlist = [{'region': 'San Jose', 'long': '-121.901782', 'installation_date': '8/6/2013', 'station_id': '2', 'lat': '37.329732', 'station_name': 'San Jose Diridon Caltrain Station', 'dockcount': '27'}, {'region': 'San Jose', 'long': '-121.888979', 'installation_date': '8/5/2013', 'station_id': '3', 'lat': '37.330698', 'station_name': 'San Jose Civic Center', 'dockcount': '15'}, {'region': 'San Jose', 'long': '-121.894902', 'installation_date': '8/6/2013', 'station_id': '4', 'lat': '37.333988', 'station_name': 'Santa Clara at Almaden', 'dockcount': '11'}, {'region': 'San Jose', 'long': '-121.8932', 'installation_date': '8/5/2013', 'station_id': '5', 'lat': '37.331415', 'station_name': 'Adobe on Almaden', 'dockcount': '19'}, {'region': 'San Jose', 'long': '-121.894074', 'installation_date': '8/7/2013', 'station_id': '6', 'lat': '37.336721', 'station_name': 'San Pedro Square', 'dockcount': '15'}, {'region': 'San Jose', 'long': '-121.886943', 'installation_date': '8/7/2013', 'station_id': '7', 'lat': '37.333798', 'station_name': 'Paseo de San Antonio', 'dockcount': '15'}, {'region': 'San Jose', 'long': '-121.885831', 'installation_date': '8/5/2013', 'station_id': '8', 'lat': '37.330165', 'station_name': 'San Salvador at 1st', 'dockcount': '15'}, {'region': 'San Jose', 'long': '-121.894715', 'installation_date': '8/5/2013', 'station_id': '9', 'lat': '37.348742', 'station_name': 'Japantown', 'dockcount': '15'}, {'region': 'San Jose', 'long': '-121.886995', 'installation_date': '8/6/2013', 'station_id': '10', 'lat': '37.337391', 'station_name': 'San Jose City Hall', 'dockcount': '15'}, {'region': 'San Jose', 'long': '-121.88566', 'installation_date': '8/6/2013', 'station_id': '11', 'lat': '37.335885', 'station_name': 'MLK Library', 'dockcount': '19'}, {'region': 'San Jose', 'long': '-121.883891', 'installation_date': '8/7/2013', 'station_id': '12', 'lat': '37.332808', 'station_name': 'SJSU 4th at San Carlos', 'dockcount': '19'}, {'region': 'San Jose', 'long': '-121.889937', 'installation_date': '8/6/2013', 'station_id': '13', 'lat': '37.339301', 'station_name': 'St James Park', 'dockcount': '15'}, {'region': 'San Jose', 'long': '-121.900084', 'installation_date': '8/5/2013', 'station_id': '14', 'lat': '37.332692', 'station_name': 'Arena Green / SAP Center', 'dockcount': '19'}, {'region': 'San Jose', 'long': '-121.877349', 'installation_date': '8/7/2013', 'station_id': '16', 'lat': '37.333955', 'station_name': 'SJSU - San Salvador at 9th', 'dockcount': '15'}, {'region': 'Redwood City', 'long': '-122.226904', 'installation_date': '8/12/2013', 'station_id': '21', 'lat': '37.481758', 'station_name': 'Franklin at Maple', 'dockcount': '15'}, {'region': 'Redwood City', 'long': '-122.232089', 'installation_date': '8/15/2013', 'station_id': '22', 'lat': '37.486078', 'station_name': 'Redwood City Caltrain Station', 'dockcount': '25'}, {'region': 'Redwood City', 'long': '-122.231061', 'installation_date': '8/15/2013', 'station_id': '23', 'lat': '37.488501', 'station_name': 'San Mateo County Center', 'dockcount': '15'}, {'region': 'Redwood City', 'long': '-122.227424', 'installation_date': '8/12/2013', 'station_id': '24', 'lat': '37.484219', 'station_name': 'Redwood City Public Library', 'dockcount': '15'}, {'region': 'Redwood City', 'long': '-122.225551', 'installation_date': '8/12/2013', 'station_id': '25', 'lat': '37.486725', 'station_name': 'Broadway at Main', 'dockcount': '15'}, {'region': 'Redwood City', 'long': '-122.223492', 'installation_date': '8/12/2013', 'station_id': '26', 'lat': '37.487682', 'station_name': 'Redwood City Medical Center', 'dockcount': '15'}, {'region': 'Mountain View', 'long': '-122.081896', 'installation_date': '8/16/2013', 'station_id': '27', 'lat': '37.389218', 'station_name': 'Mountain View City Hall', 'dockcount': '15'}, {'region': 'Mountain View', 'long': '-122.076713', 'installation_date': '8/15/2013', 'station_id': '28', 'lat': '37.394358', 'station_name': 'Mountain View Caltrain Station', 'dockcount': '23'}, {'region': 'Mountain View', 'long': '-122.106758', 'installation_date': '8/15/2013', 'station_id': '29', 'lat': '37.40694', 'station_name': 'San Antonio Caltrain Station', 'dockcount': '23'}, {'region': 'Mountain View', 'long': '-122.066553', 'installation_date': '8/16/2013', 'station_id': '30', 'lat': '37.390277', 'station_name': 'Evelyn Park and Ride', 'dockcount': '15'}, {'region': 'Mountain View', 'long': '-122.108338', 'installation_date': '12/31/2013', 'station_id': '31', 'lat': '37.400443', 'station_name': 'San Antonio Shopping Center', 'dockcount': '15'}, {'region': 'Mountain View', 'long': '-122.083678', 'installation_date': '12/31/2013', 'station_id': '32', 'lat': '37.385956', 'station_name': 'Castro Street and El Camino Real', 'dockcount': '11'}, {'region': 'Mountain View', 'long': '-122.099076', 'installation_date': '8/16/2013', 'station_id': '33', 'lat': '37.400241', 'station_name': 'Rengstorff Avenue / California Street', 'dockcount': '15'}, {'region': 'Palo Alto', 'long': '-122.164759', 'installation_date': '8/14/2013', 'station_id': '34', 'lat': '37.443988', 'station_name': 'Palo Alto Caltrain Station', 'dockcount': '23'}, {'region': 'Palo Alto', 'long': '-122.163093', 'installation_date': '8/15/2013', 'station_id': '35', 'lat': '37.444521', 'station_name': 'University and Emerson', 'dockcount': '11'}, {'region': 'Palo Alto', 'long': '-122.142805', 'installation_date': '8/14/2013', 'station_id': '36', 'lat': '37.429082', 'station_name': 'California Ave Caltrain Station', 'dockcount': '15'}, {'region': 'Palo Alto', 'long': '-122.159504', 'installation_date': '8/14/2013', 'station_id': '37', 'lat': '37.448598', 'station_name': 'Cowper at University', 'dockcount': '11'}, {'region': 'Palo Alto', 'long': '-122.137778', 'installation_date': '8/14/2013', 'station_id': '38', 'lat': '37.425684', 'station_name': 'Park at Olive', 'dockcount': '15'}, {'region': 'San Francisco', 'long': '-122.39997', 'installation_date': '8/19/2013', 'station_id': '41', 'lat': '37.795001', 'station_name': 'Clay at Battery', 'dockcount': '15'}, {'region': 'San Francisco', 'long': '-122.398436', 'installation_date': '8/19/2013', 'station_id': '42', 'lat': '37.79728', 'station_name': 'Davis at Jackson', 'dockcount': '15'}, {'region': 'San Francisco', 'long': '-122.402923', 'installation_date': '8/19/2013', 'station_id': '45', 'lat': '37.794231', 'station_name': 'Commercial at Montgomery', 'dockcount': '15'}, {'region': 'San Francisco', 'long': '-122.404767', 'installation_date': '8/19/2013', 'station_id': '46', 'lat': '37.795425', 'station_name': 'Washington at Kearney', 'dockcount': '15'}, {'region': 'San Francisco', 'long': '-122.403452', 'installation_date': '8/19/2013', 'station_id': '47', 'lat': '37.788975', 'station_name': 'Post at Kearney', 'dockcount': '19'}, {'region': 'San Francisco', 'long': '-122.398525', 'installation_date': '8/19/2013', 'station_id': '48', 'lat': '37.799953', 'station_name': 'Embarcadero at Vallejo', 'dockcount': '15'}, {'region': 'San Francisco', 'long': '-122.390264', 'installation_date': '8/20/2013', 'station_id': '49', 'lat': '37.789625', 'station_name': 'Spear at Folsom', 'dockcount': '19'}, {'region': 'San Francisco', 'long': '-122.394203', 'installation_date': '8/20/2013', 'station_id': '50', 'lat': '37.795392', 'station_name': 'Harry Bridges Plaza (Ferry Building)', 'dockcount': '23'}, {'region': 'San Francisco', 'long': '-122.391034', 'installation_date': '8/20/2013', 'station_id': '51', 'lat': '37.791464', 'station_name': 'Embarcadero at Folsom', 'dockcount': '19'}, {'region': 'San Francisco', 'long': '-122.408433', 'installation_date': '8/25/2013', 'station_id': '53', 'lat': '37.783871', 'station_name': 'Powell Street BART', 'dockcount': '19'}, {'region': 'San Francisco', 'long': '-122.388013', 'installation_date': '8/20/2013', 'station_id': '54', 'lat': '37.787152', 'station_name': 'Embarcadero at Bryant', 'dockcount': '15'}, {'region': 'San Francisco', 'long': '-122.394643', 'installation_date': '8/20/2013', 'station_id': '55', 'lat': '37.789756', 'station_name': 'Temporary Transbay Terminal (Howard at Beale)', 'dockcount': '23'}, {'region': 'San Francisco', 'long': '-122.397086', 'installation_date': '8/20/2013', 'station_id': '56', 'lat': '37.792251', 'station_name': 'Beale at Market', 'dockcount': '19'}, {'region': 'San Francisco', 'long': '-122.405127', 'installation_date': '8/21/2013', 'station_id': '57', 'lat': '37.781752', 'station_name': '5th at Howard', 'dockcount': '15'}, {'region': 'San Francisco', 'long': '-122.418235', 'installation_date': '8/21/2013', 'station_id': '58', 'lat': '37.77865', 'station_name': 'San Francisco City Hall', 'dockcount': '19'}, {'region': 'San Francisco', 'long': '-122.418603', 'installation_date': '8/21/2013', 'station_id': '59', 'lat': '37.781332', 'station_name': 'Golden Gate at Polk', 'dockcount': '23'}, {'region': 'San Francisco', 'long': '-122.403234', 'installation_date': '8/21/2013', 'station_id': '60', 'lat': '37.80477', 'station_name': 'Embarcadero at Sansome', 'dockcount': '15'}, {'region': 'San Francisco', 'long': '-122.390288', 'installation_date': '8/22/2013', 'station_id': '61', 'lat': '37.780526', 'station_name': '2nd at Townsend', 'dockcount': '27'}, {'region': 'San Francisco', 'long': '-122.396236', 'installation_date': '8/22/2013', 'station_id': '62', 'lat': '37.785299', 'station_name': '2nd at Folsom', 'dockcount': '19'}, {'region': 'San Francisco', 'long': '-122.398108', 'installation_date': '8/22/2013', 'station_id': '63', 'lat': '37.786978', 'station_name': 'Howard at 2nd', 'dockcount': '19'}, {'region': 'San Francisco', 'long': '-122.392738', 'installation_date': '8/22/2013', 'station_id': '64', 'lat': '37.782259', 'station_name': '2nd at South Park', 'dockcount': '15'}, {'region': 'San Francisco', 'long': '-122.402717', 'installation_date': '8/22/2013', 'station_id': '65', 'lat': '37.771058', 'station_name': 'Townsend at 7th', 'dockcount': '15'}, {'region': 'San Francisco', 'long': '-122.418954', 'installation_date': '8/23/2013', 'station_id': '66', 'lat': '37.774814', 'station_name': 'South Van Ness at Market', 'dockcount': '19'}, {'region': 'San Francisco', 'long': '-122.417385', 'installation_date': '8/23/2013', 'station_id': '67', 'lat': '37.776619', 'station_name': 'Market at 10th', 'dockcount': '27'}, {'region': 'San Francisco', 'long': '-122.401014', 'installation_date': '8/23/2013', 'station_id': '68', 'lat': '37.784878', 'station_name': 'Yerba Buena Center of the Arts (3rd @ Howard)', 'dockcount': '19'}, {'region': 'San Francisco', 'long': '-122.39607', 'installation_date': '8/23/2013', 'station_id': '69', 'lat': '37.776377', 'station_name': 'San Francisco Caltrain 2 (330 Townsend)', 'dockcount': '23'}, {'region': 'San Francisco', 'long': '-122.395569', 'installation_date': '8/23/2013', 'station_id': '70', 'lat': '37.776317', 'station_name': 'San Francisco Caltrain (Townsend at 4th)', 'dockcount': '19'}, {'region': 'San Francisco', 'long': '-122.408499', 'installation_date': '8/23/2013', 'station_id': '71', 'lat': '37.788446', 'station_name': 'Powell at Post (Union Square)', 'dockcount': '19'}, {'region': 'San Francisco', 'long': '-122.412919', 'installation_date': '8/23/2013', 'station_id': '72', 'lat': '37.780356', 'station_name': 'Civic Center BART (7th at Market)', 'dockcount': '23'}, {'region': 'San Francisco', 'long': '-122.407245', 'installation_date': '8/21/2013', 'station_id': '73', 'lat': '37.798522', 'station_name': 'Grant Avenue at Columbus Avenue', 'dockcount': '15'}, {'region': 'San Francisco', 'long': '-122.394434', 'installation_date': '8/25/2013', 'station_id': '74', 'lat': '37.794139', 'station_name': 'Steuart at Market', 'dockcount': '23'}, {'region': 'San Francisco', 'long': '-122.399051', 'installation_date': '8/25/2013', 'station_id': '75', 'lat': '37.7913', 'station_name': 'Mechanics Plaza (Market at Battery)', 'dockcount': '19'}, {'region': 'San Francisco', 'long': '-122.404966', 'installation_date': '8/25/2013', 'station_id': '76', 'lat': '37.786305', 'station_name': 'Market at 4th', 'dockcount': '19'}, {'region': 'San Francisco', 'long': '-122.400811', 'installation_date': '8/25/2013', 'station_id': '77', 'lat': '37.789625', 'station_name': 'Market at Sansome', 'dockcount': '27'}, {'region': 'San Jose', 'long': '-121.905733', 'installation_date': '12/31/2013', 'station_id': '80', 'lat': '37.352601', 'station_name': 'San Jose Government Center', 'dockcount': '15'}, {'region': 'San Francisco', 'long': '-122.400862', 'installation_date': '1/22/2014', 'station_id': '82', 'lat': '37.798541', 'station_name': 'Broadway St at Battery St', 'dockcount': '15'}, {'region': 'Redwood City', 'long': '-122.236234', 'installation_date': '2/20/2014', 'station_id': '83', 'lat': '37.491269', 'station_name': 'Mezes Park', 'dockcount': '15'}]

// var stationlist = [ '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '16', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31', '32', '33', '34', '35', '36', '37', '38', '41', '42', '45', '46', '47', '48', '49', '50', '51', '53', '54', '55', '56', '57', '58', '59', '60', '61', '62', '63', '64', '65', '66', '67', '68', '69', '70', '71', '72', '73', '74', '75', '76', '77', '80', '82', '83']


$.getJSON('array.json',function(d) {
	data = d;

	// get array index for station
	for(var i = 0 ; i < d[0].stations.length ; ++i) {
		if(d[0].stations[i].station_id == stationid) {
			// found it
			stationindex = i;
		}
	}

	// get max, for scale
	var maxoutflow = 0;
	for(var i = 0 ; i < d.length; ++i) {
		if(d[i].stations[stationindex].tot_outflow > maxoutflow)
			maxoutflow = d[i].stations[stationindex].tot_outflow;
	}

	// X scale will fit all values from data[] within pixels 0-w
	var x = d3.scale.linear().domain([0, d.length]).range([0, w]);
	// Y scale will fit values from 0-10 within pixels h-0 (Note the inverted domain for the y-scale: bigger is up!)
	var y = d3.scale.linear().domain([0, maxoutflow]).range([h, 0]);
		// automatically determining max range can work something like this
		// var y = d3.scale.linear().domain([0, d3.max(data)]).range([h, 0]);

	// create a line function that can convert data[] into x and y points
	var line = d3.svg.line()
		// assign the X function to plot our line as we wish
		.x(function(d,i) { 
			// verbose logging to show what's actually being done
			console.log('Plotting X value for data point: ' + d.stations[stationindex] + ' using index: ' + i + ' to be at: ' + x(i) + ' using our xScale.');
			// return the X coordinate where we want to plot this datapoint
			return x(i); 
		})
		.y(function(d) { 
			// verbose logging to show what's actually being done
			console.log('Plotting Y value for data point: ' + d.stations[stationindex] + ' to be at: ' + y(d.stations[stationindex].tot_outflow) + " using our yScale.");
			// return the Y coordinate where we want to plot this datapoint
			return y(d.stations[stationindex].tot_outflow); 
		})

		// Add the line by appending an svg:path element with the data line we created above
	// do this AFTER the axes above so that the line is above the tick-lines
		var linepath = graph.append("svg:path").attr("d", line(d));



	$('#submit').click(function() {
		stationid = $('#text').val();
		var stationname;

		// get index
		for(var i = 0 ; i < d[0].stations.length ; ++i) {
			if(d[0].stations[i].station_id == stationid) {
				// found it
				stationindex = i;
				stationname = stationlist[i].station_name;
			}
		}


		// get max, for scale
		var maxoutflow = 0;
		for(var i = 0 ; i < d.length; ++i) {
			if(d[i].stations[stationindex].tot_outflow > maxoutflow)
				maxoutflow = d[i].stations[stationindex].tot_outflow;
		}

		y = d3.scale.linear().domain([0, maxoutflow]).range([h, 0]);
			// automatically determining max range can work something like this
			// var y = d3.scale.linear().domain([0, d3.max(data)]).range([h, 0]);

		// Add the line by appending an svg:path element with the data line we created above
		// do this AFTER the axes above so that the line is above the tick-lines
		linepath.transition().attr("d", line(data));

		$('#stationname').text(stationname);

	});


});

$(document).ready(function() {
	var stationname;
	// get array index for station
	for(var i = 0 ; i < stationlist.length ; ++i) {
		if(stationlist[i].station_id == stationid) {
			// found it
			stationname = stationlist[i].station_name;
		}
	}

	$('#stationname').text(stationname);
});
function deepCopy(obj) {
    if (Object.prototype.toString.call(obj) === '[object Array]') {
        var out = [], i = 0, len = obj.length;
        for ( ; i < len; i++ ) {
            out[i] = arguments.callee(obj[i]);
        }
        return out;
    }
    if (typeof obj === 'object') {
        var out = {}, i;
        for ( i in obj ) {
            out[i] = arguments.callee(obj[i]);
        }
        return out;
    }
    return obj;
}
	</script>
 

Currently showing total outflows. Select station ID (default 11): <input id="text" type="text"> <input id="submit" type="submit">
 <p id="stationname"></p>
	</body>
</html>
